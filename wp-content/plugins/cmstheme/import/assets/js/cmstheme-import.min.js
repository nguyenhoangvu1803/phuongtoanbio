/**
 * Created by zacky on 12/21/2015.
 * @author VnZacky
 */

(function($){
    "use strict";

    $('#import-btn-submit').on('click', function(event) {
        event.preventDefault();
        var thisEl = $(this),
            parent = thisEl.parent(),
            progress_bar = $('#import-progress-bar');

        progress_bar.show();
        thisEl.hide();
        parent.append('<div class="loading">Importing data...</div>');
        var progress = setInterval(function() {
            if(parseInt($('.percent', progress_bar).text()) <= 80 ) {
                $('.percent', progress_bar).text( parseInt($('.percent',progress_bar).text()) + 10);
                $('.progress-bar', progress_bar).css('width', parseInt($('.percent').text()) + '%');
            }
        }, 2000);
        $.ajax({
            url : ajaxurl,
            type: 'POST',
            dataType : 'json',
            data : {'action' : 'cmstheme_import'},
            success: function(result) {
                if(result.status == 200) {
                    parent.find('.loading').html('Import Success! Have Fun! :) <br /><a href="'+ CMSImport.dashboard +'">Visit Site</a>');
                    $('.percent', progress_bar).text('100');
                    $('.progress-bar', progress_bar).css({'width':'100%','background-color' : '#5cb85c'});
                    $('.img-loading').hide();
                } else {
                    parent.find('.loading').html('Have problem on server. Please try import manual! <br /><a href="'+ CMSImport.dashboard +'">Visit Site</a>');
                    $('.percent', progress_bar).text('100');
                    $('.progress-bar', progress_bar).css({'width':'100%','background-color' : '#C9302C'});
                    $('.img-loading').hide();
                }
                clearInterval(progress);
            },
        });
        return false;
    });
})(jQuery);